<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Async JavaScript Practice Problem</title>
    <script src="https://code.jquery.com/jquery-3.6.0.js" integrity="sha256-H+K7U5CnXl1h5ywQfKtSj8PCmoN9aaq30gDh27Xc0jk=" crossorigin="anonymous"></script>
</head>
<body>
    
    


    <script>
        // Vanilla JavaScript Async Practice Problem
        const url = 'https://jsonplaceholder.typicode.com/todos';
        const xhttp = new XMLHttpRequest();
        xhttp.onreadystatechange = function() {
            if (this.readyState == 4 && this.status == 200) {
            // Typical action to be performed when the document is ready:
                // Step One
                // console.log(xhttp.responseText);

                // Step Two
                userOutput(xhttp.responseText);
            }
        };
        xhttp.open("GET", url, true);
        xhttp.send();

        // Step #2
        // Create a function that will loop through and print the userID to h2 element
        function userOutput(arr) {
            const dataSet = JSON.parse(arr);
            const dataByUserId = {};

            for(let data of dataSet) {
                if(dataByUserId[data.userId]) {
                    dataByUserId[data.userId].push(data);
                } else {
                    dataByUserId[data.userId] = [data]
                }
            }

            for(let key in dataByUserId) {
                const container = document.createElement('div');
                const newH2 = document.createElement('h2');
                document.body.appendChild(container);
                container.appendChild(newH2);
                container.id = key;
                newH2.textContent = `User ${key}`
                
                // Step 3
                // Create loop to iterate through dataByUserId to push title to p element and append to container
                for(let i = 0; i < dataByUserId[key].length; i++) {
                    if(dataByUserId[key][i].userId == key) {
                        const newP = document.createElement('p');
                        container.appendChild(newP);
                        newP.textContent = dataByUserId[key][i].title;
                    }
                }
            }
            console.log(dataByUserId)
            console.log(dataSet)
        }        

    </script>
</body>
</html>